<section class="relative fix" id="sc3">
    <div class="container">
        <div class="space-50"></div>
        <div class="row">
            <div class="col-xs-12 col-sm-8 col-sm-offset-2 col-md-6 col-md-offset-3 text-center">
                <h2>Book detail</h2>
                <div class="space-20"></div>
                <div class="title-bar blue">
                    <ul class="list-inline list-unstyled">
                        <li><i class="icofont icofont-square"></i></li>
                        <li><i class="icofont icofont-square"></i></li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12 col-md-6 book-list-position padding60  ">
                <div class="book-list-photo ">
                    <% if (typeof(data.item.media) != 'undefined') { %>
                        <div class="book-list">
                            <% data.item.media.forEach(function (image) { %>
                            <div class="book_item">
                                <img src="<%= image.web.medium_path %>" alt="library">
                            </div>
                            <% }) %>
                        </div>
                    <% } %>
                </div>
                <div class="bookslide_nav">
                    <i class="icofont icofont-long-arrow-left testi_prev"></i>
                    <i class="icofont icofont-long-arrow-right testi_next"></i>
                </div>
            </div>
            <div class="col-xs-12 pull-right col-md-6 padding60 wow fadeInRight">
                <div class="book-content">
                    <div class="book-details-item">
                        <h4 class="tip-left">Title</h4>
                        <p class="lead"><%= data.item.title %></p>
                        <div class="space-10"></div>
                        <div class="row">
                            <div class="col-xs-12 col-sm-8">
                                <h4 class="tip-left">Author</h4>
                                <div class="media">
                                    <% if (typeof (data.item.author) != 'undefined' && data.item.author) { %>
                                    <div class="media-body">
                                        <img src="/images/user_default.png" class="media-object author-photo img-thumbnail" alt="library">
                                        <br>
                                        <h5><%= data.item.author %></h5>
                                    </div>
                                    <% } else { %>
                                    <div class="media-left">
                                        <img src="/images/logo_framgia.png" class="media-object author-photo background--white img-thumbnail" alt="library">
                                        <br>
                                        <h5> By Framgia </h5>
                                    </div>
                                    <% } %>
                                </div>
                            </div>
                        </div>
                        <div class="space-30"></div>
                        <h4 class="tip-left">Description</h4>
                        <p><%= data.item.description %></p>
                        <div class="space-20"></div>
                        <h4 class="tip-left">Rating</h4>
                        <input id="rating-book" name="star" class="rating" data-min="0" data-max="5" value=<%= data.item.avg_star %> disabled="true" data-step="0.01" data-size="xs">
                        <div class="space-20"></div>
                        <% if (typeof user !== 'undefined') { %>
                            <% if (data.item.status === 0) { %>
                                <%
                                    if (
                                        data.item.user_reading_book !== null
                                        && user.id === data.item.user_reading_book.id
                                    ) {
                                %>
                                        <button class="btn btn-primary hover-btn-default btn-xs" id="booking-book" data-id="<%= data.item.id %>" data-status="<%= configs.book_user.done %>">Return Book</button>
                                <%
                                    } else if (
                                            data.item.user_reading_book !== null
                                            && data.item.users_waiting_book.length === 0
                                    ) {
                                %>
                                    <button class="btn btn-primary hover-btn-default btn-xs" id="booking-book" data-id="<%= data.item.id %>" data-status="<%= configs.book_user.waiting %>">Add to Waiting</button>
                                <% } %>
                                <%
                                    if (data.item.users_waiting_book.length > 0) {
                                        var flag = true;
                                        data.item.users_waiting_book.forEach(function (user_waiting) {
                                            if (user.id === user_waiting.id) {
                                                flag = false;
                                %>
                                                <button
                                                    class="btn btn-primary hover-btn-default btn-xs"
                                                    id="booking-book" data-id="<%= data.item.id %>"
                                                    data-status="3">Cancel Waiting
                                                </button>
                                            <% } %>
                                        <% }) %>

                                        <% if (flag) { %>
                                            <button class="btn btn-primary hover-btn-default btn-xs" id="booking-book" data-id="<%= data.item.id %>" data-status="<%= configs.book_user.waiting %>">Add to Waiting</button>
                                        <% } %>
                                    <% } %>
                            <% } else if (data.item.status === 1) { %>
                                <button class="btn btn-primary hover-btn-default btn-xs" id="booking-book" data-id="<%= data.item.id %>" data-status="<%= configs.book_user.reading %>">Add to Reading</button>
                            <% } %>
                        <% } else { %>
                            <button class="btn btn-primary hover-btn-default btn-xs" id="booking-book" data-id="<%= data.item.id %>" data-status="<%= configs.book_user.reading %>">Add to Reading</button>
                        <% } %>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<section class="relative" id="sc5">
    <div class="container">
        <div class="panel">
            <div class="panel-heading">
                <ul class="nav nav-tabs">
                    <li class="active"><a data-toggle="tab" href="#user_review">User Review</a></li>
                    <li><a data-toggle="tab" href="#user_reading">User Reading</a></li>
                    <li><a data-toggle="tab" href="#user_waiting">User Waiting</a></li>
                </ul>
            </div>
            <div class="panel-body">
                <div class="tab-content">
                    <div class="tab-pane fade in active" id="user_review">
                        <div class="row event-list">
                            <% if (data.item.reviews_detail_book !== null) { %>
                            <% data.item.reviews_detail_book.forEach(function (review) { %>
                            <div class="col-xs-12 col-sm-8 col-sm-offset-2 col-md-9">
                                <div class="event-item wow fadeInRight">
                                    <h4 class="show tip-left"><%= review.created_at %></h4>
                                    <div class="well">
                                        <div class="media">
                                            <div class="media-left">
                                                <% if (review.user.avatar !== null) { %>
                                                <img src="<%= review.user.avatar %>" class="media-object w-70-h-70" alt="library">
                                                <% } else { %>
                                                <img src="/images/user/icon_user_default.png" class="media-object  w-70-h-70" alt="library">
                                                <% } %>
                                            </div>
                                            <div class="media-body">
                                                <div class="space-10"></div>
                                                <a href="javascript:void(0)"><h4 class="media-heading"><%= review.user.name %></h4></a>
                                                <div class="space-10"></div>
                                                <ul class="list-inline list-unstyled rating-star">
                                                <% for (var i=0; i<review.star; i++) { %>
                                                    <li class="active"><i class="icofont icofont-star"></i></li>
                                                <% } %>
                                                </ul>
                                                <p><%= review.content %></p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="space-20"></div>
                            </div>
                            <% }) %>
                            <% } %>
                        </div>
                        <div class="row ">
                            <div class="col-xs-12 col-sm-8 col-sm-offset-2 col-md-9">
                                <h4><strong>Add review</strong></h4>
                            </div>
                            <div class="col-xs-12 col-sm-8 col-sm-offset-2 col-md-9">
                                <%- include ../shared/validator_errors.ejs %>
                            </div>
                            <form action="/books/review/<%= data.item.id %>" id="form-review" method="post">
                                <div class="col-xs-12 col-sm-8 col-sm-offset-2 col-md-9">
                                    <div class="form-group">
                                        <% if (typeof(dataReview) != 'undefined' && dataReview && typeof(user) != 'undefined' && typeof(dataReview.user) != 'undefined' && dataReview.user.id == user.id
                                        ) { %>
                                            <textarea name="content" id="content" class="form-control bg-info" cols="50" rows="5"placeholder="Enter your review..." required> <%= dataReview.content%> </textarea>
                                            <div class="col-xs-12 col-sm-12 col-md-12">
                                                <input id="rating-book" name="star" class="rating" data-min="0" data-max="5" data-step="1" value=<%= dataReview.star %> data-size="xs">
                                            </div>
                                        <% } else { %>
                                            <textarea name="content" id="content" class="form-control bg-info" cols="50" rows="5" placeholder="Enter your review..." required></textarea>
                                            <div class="col-xs-12 col-sm-12 col-md-12">
                                                <input id="rating-book" name="star" class="rating" data-min="0" data-max="5" data-step="1" data-size="xs">
                                            </div>
                                        <% } %>
                                    </div>
                                </div>
                                <div class="space-20"></div>
                                <div class="col-xs-12 col-sm-8 col-sm-offset-2 col-md-9">
                                    <% if (typeof(dataReview) != 'undefined' && dataReview && typeof(user) != 'undefined' && typeof(dataReview.user) != 'undefined' && dataReview.user.id == user.id
                                        ) { %>
                                        <button type="submit" class="btn btn-primary hover-btn-default"> Edit review <i class="fa fa-long-arrow-right"></i></button>
                                    <% } else { %>
                                        <button type="submit" class="btn btn-primary hover-btn-default"> Review <i class="fa fa-long-arrow-right"></i></button>
                                    <% } %>
                                </div>
                            </form>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="user_reading">
                        <div class="row event-list">
                            <% if (data.item.user_reading_book !== null) { %>
                            <div class="col-xs-12 col-sm-8 col-sm-offset-2 col-md-9">
                                <div class="event-item wow fadeInRight">
                                    <div class="well">
                                        <div class="media">
                                            <div class="media-left">
                                                <% if (data.item.user_reading_book.avatar !== null) { %>
                                                <img src="<%= data.item.user_reading_book.avatar %>" class="media-object" alt="library">
                                                <% } else { %>
                                                <img src="/images/user/icon_user_default.png" class="media-object" alt="library">
                                                <% } %>
                                            </div>
                                            <div class="media-body">
                                                <div class="space-10"></div>
                                                <a href="#"><h4 class="media-heading"><%= data.item.user_reading_book.name %></h4></a>
                                                <div class="space-10"></div>
                                                <p><%= data.item.user_reading_book.name %></p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <% } %>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="user_waiting">
                        <div class="row event-list">
                            <% if (data.item.users_waiting_book) { %>
                            <% data.item.users_waiting_book.forEach(function (user) { %>
                            <div class="col-xs-12 col-sm-8 col-sm-offset-2 col-md-9">
                                <div class="event-item wow fadeInRight">
                                    <div class="well">
                                        <div class="media">
                                            <div class="media-left">
                                                <% if (user.avatar !== null) { %>
                                                    <img src="<%= user.avatar %>" class="media-object w-70-h-70" alt="library">
                                                <% } else { %>
                                                    <img src="/images/user/icon_user_default.png" class="media-object w-70-h-70" alt="library">
                                                <% } %>
                                            </div>
                                            <div class="media-body">
                                                <div class="space-10"></div>
                                                <a href="books.html"><h4 class="media-heading"><%= user.name %></h4></a>
                                                <div class="space-10"></div>
                                                <p><%= user.name %></p>

                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="space-20"></div>
                            </div>
                            <% }) %>
                            <% } %>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="space-100"></div>
</section>

<%- contentFor('appjs') %>
<script src="/javascripts/books/book.js" type="text/javascript"></script>
<script type="text/javascript">
    $('#form-review').validate();

    $('#booking-book').on('click', function (e) {
        var status = $(this).attr('data-status');
        var bookId = $(this).attr('data-id');

        Book.booking(bookId,status);
    });

</script>
<script src="/bower/bootstrap-star-rating/js/star-rating.js"></script>

<%- contentFor('appCss') %>
<link href="/bower/bootstrap-star-rating/css/star-rating.css" rel="stylesheet" type="text/css">
<link href="/bower/bootstrap-star-rating/css/theme-krajee-fa.css" rel="stylesheet" type="text/css">
