<section class="relative fix">
    <div class="container">
        <div class="space-30"></div>
        <div class="row">
            <div class="col-xs-12 col-sm-8 col-sm-offset-2 col-md-6 col-md-offset-3 text-center">
                <h2>Book detail</h2>
                <div class="space-20"></div>
                <div class="title-bar blue">
                    <ul class="list-inline list-unstyled">
                        <li><i class="icofont icofont-square"></i></li>
                        <li><i class="icofont icofont-square"></i></li>
                    </ul>
                </div>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12 col-md-6 book-list-position padding60  ">
                <div class="book-list-photo">
                    <% if (typeof(data.item.media) != 'undefined') { %>
                        <div class="book-list">
                            <% data.item.media.forEach(function (image) { %>
                            <div class="book_item">
                                <img src="<%= image.web.medium_path %>" alt="library">
                            </div>
                            <% }) %>
                        </div>
                    <% } %>
                </div>
                <div class="bookslide_nav">
                    <i class="icofont icofont-long-arrow-left testi_prev"></i>
                    <i class="icofont icofont-long-arrow-right testi_next"></i>
                </div>
            </div>
            <div class="col-xs-12 pull-right col-md-6 padding60 wow fadeInRight">
                <div class="book-content">
                    <div class="book-details-item">
                        <h4 class="tip-left">Title</h4>
                        <p class="lead"><%= data.item.title %></p>
                        <div class="space-10"></div>
                        <h4 class="tip-left">Count view: <%= data.item.count_view %></h4>
                        <div class="space-10"></div>
                        <div class="row">
                            <div class="col-xs-12 col-sm-8">
                                <h4 class="tip-left">Author</h4>
                                <div class="media">
                                    <div class="media-left">
                                        <img src="<%= data.item.author ? '/images/user_default.png' : '/images/logo_framgia.png' %>"
                                             class="media-object author-photo img-thumbnail"
                                             alt="library">
                                    </div>
                                    <div class="media-body">
                                        <h5><%= data.item.author ? data.item.author : Framgia %></h5>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="space-30"></div>
                        <div class="row">
                            <div class="col-xs-12 col-sm-8">
                                <h4 class="tip-left">Owner By</h4>
                                <% if (data.item.owners) { %>
                                    <% data.item.owners.forEach(function (owner) { %>
                                        <a class="owner-image" data-toggle="tooltip" title="<%= owner.name %>" href="/users/<%= owner.id %>">
                                            <img class="img-owner-detail img-circle" src="<%= (owner && owner.avatar) ? owner.avatar : '/images/user_default.png' %>"
                                                 class="media-object author-photo img-thumbnail <%= owner ? '' : 'background--white' %>"
                                                 alt="library">
                                        </a>
                                    <% }) %>
                                <% } else { %>
                                    <div class="media">
                                        <div class="media-left">
                                            <img src="/images/logo_framgia.png"
                                                 class="media-object author-photo img-thumbnailbackground--white"
                                                 alt="library">
                                        </div>
                                        <div class="media-body">
                                            <p>Framgia</p>
                                        </div>
                                    </div>
                                <% } %>
                            </div>
                        </div>
                        <div class="space-30"></div>
                        <h4 class="tip-left">Description</h4>
                        <p><%= data.item.description %></p>
                        <div class="space-20"></div>
                        <h4 class="tip-left">Rating</h4>
                        <input id="rating-book" name="star" class="rating" data-min="0" data-max="5" value=<%= data.item.avg_star %> disabled="true" data-step="0.01" data-size="xs">
                        <div class="row">
                            <div class="col-xs-12 col-sm-4">
                                <div class="media">
                                    <div class="media-body">
                                        <a href="#user_review">
                                            <span class="badge"><%= data.item.reviews_detail.length %></span> Review
                                        <span class="badge"></a>
                                    </div>
                                </div>
                            </div>
                            <div class="col-xs-12 col-sm-4">
                                <div class="media">
                                    <div class="media-body">
                                        <a href="#user_waiting">
                                            <span class="badge"><%= data.item.users_waiting.length %></span> Waiting
                                        </a>
                                    </div>
                                </div>
                            </div>
                            <div class="col-xs-12 col-sm-4">
                                <div class="media">
                                    <div class="media-body">
                                        <a href="#user_reading">
                                            <span class="badge"><%= data.item.users_reading.length %></span> Reading
                                        </a>
                                    </div>
                                </div>
                            </div>
                            <div class="col-xs-12 col-sm-4">
                                <div class="media">
                                    <div class="media-body">
                                        <a href="#user_returning">
                                            <span class="badge"><%= data.item.users_returning.length %></span> Returning
                                        </a>
                                    </div>
                                </div>
                            </div>
                            <div class="col-xs-12 col-sm-4">
                                <div class="media">
                                    <div class="media-body">
                                        <a href="#user_returning">
                                            <span class="badge"><%= data.item.users_returned.length %></span> Returned
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="space-20"></div>
                        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#myModal"> <%= data.item.btn_booking.text %> </button>
                    </div>
                </div>
            </div>
        </div>

        <!--Begin Modal Owner-->
        <div aria-labelledby="myModalLabel" class="modal fade" id="myModal" role="dialog" style="display: none;" tabindex="-1">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <button aria-label="Close" class="close" data-dismiss="modal" type="button"><span aria-hidden="true">×</span></button>
                        <h5 class="modal-title" id="myModalLabel">
                            Bạn muốn mượn sách <%= data.item.title %> của ai ?
                        </h5>
                    </div>
                    <div class="modal-body">
                        <form action="/books/booking/<%= data.item.id %>" method="post" id="form-booking-book" novalidate="novalidate">
                            <input type="hidden" name="status" value="<%= data.item.btn_booking.status %>">
                            <div class="row">
                                <div class="col-xs-12 col-sm-6">
                                    <div class="checkbox">
                                        <label for="owner_id_01">
                                            <input type="radio" id="owner_id_01" name="owner_id" value="1" required aria-required="true"/> Owner_01
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-xs-12 col-sm-6">
                                    <div class="checkbox">
                                        <label for="owner_id_02">
                                            <input type="radio" id="owner_id_02" name="owner_id" value="1"/> Owner_01
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-xs-12 col-sm-6">
                                    <div class="checkbox">
                                        <label for="owner_id_03">
                                            <input type="radio" id="owner_id_03" name="owner_id" value="1"/> Owner_01
                                        </label>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-xs-12 col-sm-6">
                                    <button type="submit" class="btn btn-primary btn-xs" id="booking-book"><%= data.item.btn_booking.text %><i class="fa fa-long-arrow-right"></i></button>
                                    <input type="reset" class="btn btn-danger btn-xs"/>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        <!--End Modal Owner-->
    </div>
</section>

<section class="relative">
    <div class="container">
        <div class="panel">
            <div class="panel-heading">
                <ul class="nav nav-tabs">
                    <li class="active"><a data-toggle="tab" href="#user_review">User Review</a></li>
                    <li><a data-toggle="tab" href="#user_reading">User Reading</a></li>
                    <li><a data-toggle="tab" href="#user_waiting">User Waiting</a></li>
                    <li><a data-toggle="tab" href="#user_returning">User Returning</a></li>
                    <li><a data-toggle="tab" href="#user_returned">User Returned</a></li>
                </ul>
            </div>
            <div class="panel-body">
                <div class="tab-content">
                    <div class="tab-pane fade in active" id="user_review">
                        <div class="row event-list">
                            <% if (data.item.reviews_detail.length > 0) { %>
                                <% data.item.reviews_detail.forEach(function (review) { %>
                                <div class="col-xs-12 col-sm-8 col-sm-offset-2 col-md-9">
                                    <div class="event-item wow fadeInRight">
                                        <h4 class="show tip-left"><%= review.created_at %></h4>
                                        <div class="well padding5 owner-clear">
                                            <div class="media">
                                                <div class="media-left">
                                                    <% if (review.user.avatar !== null) { %>
                                                    <a href="/users/<%= review.user.id %>">
                                                        <img src="<%= review.user.avatar %>" class="media-object w-70-h-70" alt="library">
                                                    </a>
                                                    <% } else { %>
                                                        <a href="/users/<%= review.user.id %>">
                                                            <img src="/images/user/icon_user_default.png" class="media-object  w-70-h-70" alt="library">
                                                        </a>
                                                    <% } %>
                                                </div>
                                                <div class="media-body">
                                                    <a href="/users/<%= review.user.id %>">
                                                        <h4 class="media-heading list-inline list-unstyled rating-star">
                                                            <%= review.user.name %>
                                                            <% for (var i=0; i<review.star; i++) { %>
                                                            <li class="active"><i class="icofont icofont-star"></i></li>
                                                            <% } %>
                                                        </h4>
                                                    </a>
                                                    <p><%= review.content %></p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <% }) %>
                            <% } %>
                        </div>
                        <div class="row ">
                            <div class="col-xs-12 col-sm-8 col-sm-offset-2 col-md-9">
                                <h4><strong>Add review</strong></h4>
                            </div>
                            <div class="col-xs-12 col-sm-8 col-sm-offset-2 col-md-9">
                                <%- include ../shared/validator_errors.ejs %>
                            </div>
                            <form action="/books/review/<%= data.item.id %>" id="form-review" method="post">
                                <div class="col-xs-12 col-sm-8 col-sm-offset-2 col-md-9">
                                    <div class="form-group">
                                        <div class="col-xs-12 col-sm-12 col-md-12">
                                            <% if (data.item.current_user_review !== null) { %>
                                                <textarea name="content" id="content" class="form-control bg-info" cols="50" rows="5"placeholder="Enter your review..." required> <%= data.item.current_user_review.content %> </textarea>
                                                    <input id="rating-book" name="star" class="rating" data-min="0" data-max="5" data-step="1" value=<%= data.item.current_user_review.star %> data-size="xs">
                                            <% } else { %>
                                                <textarea name="content" id="content" class="form-control bg-info" cols="50" rows="5" placeholder="Enter your review..." required></textarea>
                                                <input id="rating-book" name="star" class="rating" data-min="0" data-max="5" data-step="1" data-size="xs">
                                            <% } %>
                                        </div>
                                    </div>
                                </div>
                                <div class="space-10"></div>
                                <div class="col-xs-12 col-sm-8 col-sm-offset-2 col-md-9">
                                    <div class="col-xs-12 col-sm-12 col-md-12">
                                        <% if (data.item.current_user_review !== null) { %>
                                            <button type="submit" class="btn btn-primary hover-btn-default"> Edit review <i class="fa fa-long-arrow-right"></i></button>
                                        <% } else { %>
                                            <button type="submit" class="btn btn-primary hover-btn-default"> Review <i class="fa fa-long-arrow-right"></i></button>
                                        <% } %>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>

                    <% if (data.item.users_reading) { %>
                        <div class="tab-pane fade" id="user_reading">
                        <div class="row event-list">
                            <% if (data.item.users_reading.length > 0) { %>
                                <% data.item.users_reading.forEach(function (user) { %>
                                <div class="col-xs-12 col-sm-8 col-sm-offset-2 col-md-9" id="user-<%= user.id %>">
                                    <div class="event-item wow fadeInRight">
                                        <% if (data.item.owners) { %>
                                            <% data.item.owners.forEach(function (owner) { %>
                                                <div class="media-left owner-right">
                                                    <% if (owner.id === user.owner_id) { %>
                                                        <a href="/users/<%= owner.id %>">
                                                            <img src="<%= owner.avatar ? owner.avatar : '/images/user/icon_user_default.png'%>" class="w-30-h-30" alt="library">
                                                            <%= owner.name %>
                                                        </a><strong>[Owner this book]</strong>
                                                    <% } %>
                                                </div>
                                            <% }) %>
                                        <% } %>
                                        <div class="well padding5 owner-clear">
                                            <div class="media">
                                                <div class="media-left">
                                                    <% if (user.avatar !== null) { %>
                                                        <a href="/users/<%= user.id %>">
                                                            <img src="<%= user.avatar %>" class="media-object w-70-h-70" alt="library">
                                                        </a>
                                                    <% } else { %>
                                                        <a href="/users/<%= user.id %>">
                                                            <img src="/images/user/icon_user_default.png" class="media-object w-70-h-70" alt="library">
                                                        </a>
                                                    <% } %>
                                                </div>
                                                <div class="media-body">
                                                    <div class="space-10"></div>
                                                    <a href="/users/<%= user.id %>"><h4 class="media-heading"><%= user.name %></h4></a>
                                                    <div class="space-10"></div>
                                                    <p><%= user.email %></p>

                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <% }) %>
                            <% } %>
                        </div>
                    </div>
                   <% } else { %>
                       No user reading this book
                   <% } %>

                    <% if (data.item.users_waiting) { %>
                        <div class="tab-pane fade" id="user_waiting">
                        <div class="row event-list">
                            <% if (data.item.users_waiting.length > 0) { %>
                                <% data.item.users_waiting.forEach(function (user) { %>
                                <div class="col-xs-12 col-sm-8 col-sm-offset-2 col-md-9" id="user-<%= user.id %>">
                                    <div class="event-item wow fadeInRight">
                                        <% if (data.item.owners) { %>
                                            <% data.item.owners.forEach(function (owner) { %>
                                                <div class="media-left owner-right">
                                                    <% if (owner.id === user.owner_id) { %>
                                                        <a href="/users/<%= owner.id %>">
                                                            <img src="<%= owner.avatar ? owner.avatar : '/images/user/icon_user_default.png'%>" class="w-30-h-30" alt="library">
                                                            <%= owner.name %>
                                                        </a><strong>[Owner this book]</strong>
                                                    <% } %>
                                                </div>
                                            <% }) %>
                                        <% } %>
                                        <div class="well padding5 owner-clear">
                                            <div class="media">
                                                <div class="media-left">
                                                    <% if (user.avatar !== null) { %>
                                                        <a href="/users/<%= user.id %>">
                                                            <img src="<%= user.avatar %>" class="media-object w-70-h-70" alt="library">
                                                        </a>
                                                    <% } else { %>
                                                        <a href="/users/<%= user.id %>">
                                                            <img src="/images/user/icon_user_default.png" class="media-object w-70-h-70" alt="library">
                                                        </a>
                                                    <% } %>
                                                </div>
                                                <div class="media-body">
                                                    <div class="space-10"></div>
                                                    <a href="/users/<%= user.id %>"><h4 class="media-heading"><%= user.name %></h4></a>
                                                    <div class="space-10"></div>
                                                    <p><%= user.email %></p>

                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <% }) %>
                            <% } %>
                        </div>
                    </div>
                   <% } else { %>
                       No user waiting to read this book
                   <% } %>

                   <% if (data.item.users_returning) { %>
                       <div class="tab-pane fade" id="user_returning">
                       <div class="row event-list">
                           <% if (data.item.users_returning.length > 0) { %>
                               <% data.item.users_returning.forEach(function (user) { %>
                               <div class="col-xs-12 col-sm-8 col-sm-offset-2 col-md-9" id="user-<%= user.id %>">
                                   <div class="event-item wow fadeInRight">
                                       <% if (data.item.owners) { %>
                                           <% data.item.owners.forEach(function (owner) { %>
                                               <div class="media-left owner-right">
                                                   <% if (owner.id === user.owner_id) { %>
                                                       <a href="/users/<%= owner.id %>">
                                                           <img src="<%= owner.avatar ? owner.avatar : '/images/user/icon_user_default.png'%>" class="w-30-h-30" alt="library">
                                                           <%= owner.name %>
                                                       </a><strong>[Owner this book]</strong>
                                                   <% } %>
                                               </div>
                                           <% }) %>
                                       <% } %>
                                       <div class="well padding5 owner-clear">
                                           <div class="media">
                                               <div class="media-left">
                                                   <% if (user.avatar !== null) { %>
                                                       <a href="/users/<%= user.id %>">
                                                           <img src="<%= user.avatar %>" class="media-object w-70-h-70" alt="library">
                                                       </a>
                                                   <% } else { %>
                                                       <a href="/users/<%= user.id %>">
                                                           <img src="/images/user/icon_user_default.png" class="media-object w-70-h-70" alt="library">
                                                       </a>
                                                   <% } %>
                                               </div>
                                               <div class="media-body">
                                                   <div class="space-10"></div>
                                                   <a href="/users/<%= user.id %>"><h4 class="media-heading"><%= user.name %></h4></a>
                                                   <div class="space-10"></div>
                                                   <p><%= user.email %></p>

                                               </div>
                                           </div>
                                       </div>
                                   </div>
                               </div>
                               <% }) %>
                           <% } %>
                       </div>
                   </div>
                  <% } else { %>
                      No user returning this book
                  <% } %>

                   <% if (data.item.users_returned) { %>
                       <div class="tab-pane fade" id="user_returned">
                       <div class="row event-list">
                           <% if (data.item.users_returned.length > 0) { %>
                               <% data.item.users_returned.forEach(function (user) { %>
                               <div class="col-xs-12 col-sm-8 col-sm-offset-2 col-md-9" id="user-<%= user.id %>">
                                   <div class="event-item wow fadeInRight">
                                       <% if (data.item.owners) { %>
                                           <% data.item.owners.forEach(function (owner) { %>
                                               <div class="media-left owner-right">
                                                   <% if (owner.id === user.owner_id) { %>
                                                       <a href="/users/<%= owner.id %>">
                                                           <img src="<%= owner.avatar ? owner.avatar : '/images/user/icon_user_default.png'%>" class="w-30-h-30" alt="library">
                                                           <%= owner.name %>
                                                       </a><strong>[Owner this book]</strong>
                                                   <% } %>
                                               </div>
                                           <% }) %>
                                       <% } %>
                                       <div class="well padding5 owner-clear">
                                           <div class="media">
                                               <div class="media-left">
                                                   <% if (user.avatar !== null) { %>
                                                       <a href="/users/<%= user.id %>">
                                                           <img src="<%= user.avatar %>" class="media-object w-70-h-70" alt="library">
                                                       </a>
                                                   <% } else { %>
                                                       <a href="/users/<%= user.id %>">
                                                           <img src="/images/user/icon_user_default.png" class="media-object w-70-h-70" alt="library">
                                                       </a>
                                                   <% } %>
                                               </div>
                                               <div class="media-body">
                                                   <div class="space-10"></div>
                                                   <a href="/users/<%= user.id %>"><h4 class="media-heading"><%= user.name %></h4></a>
                                                   <div class="space-10"></div>
                                                   <p><%= user.email %></p>

                                               </div>
                                           </div>
                                       </div>
                                   </div>
                               </div>
                               <% }) %>
                           <% } %>
                       </div>
                   </div>
                  <% } else { %>
                      No user returned this book
                  <% } %>

                </div>
            </div>
        </div>
    </div>
    <div class="space-100"></div>
</section>

<%- contentFor('appjs') %>
<script src="/javascripts/books/book.js" type="text/javascript"></script>
<script type="text/javascript">
    $('#form-review').validate({highlight: function(element) {
        $(element).closest('.form-group').addClass('has-error');
    },
    unhighlight: function(element) {
        $(element).closest('.form-group').removeClass('has-error');
    },
    errorElement: 'p',
        errorClass: 'error',
        errorPlacement: function(error, element) {
        error.insertAfter(element);
    }});

</script>
<script src="/bower/bootstrap-star-rating/js/star-rating.js"></script>

<%- contentFor('appCss') %>
<link href="/bower/bootstrap-star-rating/css/star-rating.css" rel="stylesheet" type="text/css">
<link href="/bower/bootstrap-star-rating/css/theme-krajee-fa.css" rel="stylesheet" type="text/css">
